<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Orden con MIMO - Tareas</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        :root {
            --mirate-color: #614385;
            --imagina-color: #F1C40F;
            --muevete-color: #E67E22;
            --ordena-color: #27AE60;
            --background-color: #e0f7fa;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
        }
        
        .header {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--ordena-color);
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .mimo-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .category-btn.mirate {
            background-color: var(--mirate-color);
            color: white;
        }
        
        .category-btn.imagina {
            background-color: var(--imagina-color);
        }
        
        .category-btn.muevete {
            background-color: var(--muevete-color);
        }
        
        .category-btn.ordena {
            background-color: var(--ordena-color);
            color: white;
        }
        
        .tasks {
            margin-top: 30px;
        }
        
        .task-item {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-info h3 {
            margin: 0 0 5px 0;
        }
        
        .task-description {
            color: #666;
            font-size: 14px;
        }
        
        .task-category {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .task-category.MIRATE {
            background-color: var(--mirate-color);
            color: white;
        }
        
        .task-category.IMAGINA {
            background-color: var(--imagina-color);
        }
        
        .task-category.MUEVETE {
            background-color: var(--muevete-color);
        }
        
        .task-category.ORDENA {
            background-color: var(--ordena-color);
            color: white;
        }
        
        .task-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .complete-btn {
            background-color: var(--ordena-color);
            color: white;
        }
        
        .edit-btn {
            background-color: #3498db;
            color: white;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .add-task-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--ordena-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            border: none;
        }
        
        .completed {
            text-decoration: line-through;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Orden con MIMO</div>
        <div class="nav-links">
            <a href="/tareas">Mis Tareas</a>
            <a href="/espacios">Mis Espacios</a>
            <form th:action="@{/logout}" method="post" style="display: inline;">
                <button type="submit" style="background: none; border: none; cursor: pointer; color: #333; font-weight: 500;">Cerrar sesión</button>
            </form>
        </div>
    </div>
    
    <div class="container">
        <h1>Mis Tareas</h1>
        
        <div class="mimo-categories">
            <button class="category-btn mirate">Mírate</button>
            <button class="category-btn imagina">Imagina</button>
            <button class="category-btn muevete">Muévete</button>
            <button class="category-btn ordena">Ordena</button>
            <button class="category-btn" style="background-color: #aaa;">Todas</button>
        </div>
        
        <div class="tasks">
            <div th:each="tarea : ${tareas}" class="task-item" th:classappend="${tarea.completada} ? 'completed' : ''">
                <div class="task-info">
                    <h3 th:text="${tarea.titulo}">Título de la tarea</h3>
                    <p class="task-description" th:text="${tarea.descripcion}">Descripción de la tarea</p>
                    <span class="task-category" th:text="${tarea.categoria}" th:classappend="${tarea.categoria}">CATEGORIA</span>
                </div>
                <div class="task-actions">
                    <button class="action-btn complete-btn" th:attr="data-id=${tarea.id}" th:text="${tarea.completada ? 'Desmarcar' : 'Completar'}">Completar</button>
                    <button class="action-btn edit-btn" th:attr="data-id=${tarea.id}">Editar</button>
                    <button class="action-btn delete-btn" th:attr="data-id=${tarea.id}">Eliminar</button>
                </div>
            </div>
            
            <div th:if="${#lists.isEmpty(tareas)}" style="text-align: center; margin-top: 50px;">
                <p>No tienes tareas pendientes. ¡Agrega una nueva tarea para comenzar!</p>
            </div>
        </div>
        
        <button class="add-task-btn">+</button>
    </div>
    
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // Filtrar por categoría
            const categoryButtons = document.querySelectorAll('.category-btn');
            const taskItems = document.querySelectorAll('.task-item');
            
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.textContent.trim();
                    
                    taskItems.forEach(task => {
                        if (category === 'Todas') {
                            task.style.display = 'flex';
                        } else {
                            const taskCategory = task.querySelector('.task-category').textContent.trim();
                            const formattedCategory = category.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
                            
                            if (taskCategory === formattedCategory) {
                                task.style.display = 'flex';
                            } else {
                                task.style.display = 'none';
                            }
                        }
                    });
                });
            });
            
            // Completar tarea
            const completeButtons = document.querySelectorAll('.complete-btn');
            
            completeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const taskId = this.getAttribute('data-id');
                    
                    fetch(`/api/tareas/${taskId}/toggle-completada`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            window.location.reload();
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
            
            // Eliminar tarea
            const deleteButtons = document.querySelectorAll('.delete-btn');
            
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (confirm('¿Estás seguro de que deseas eliminar esta tarea?')) {
                        const taskId = this.getAttribute('data-id');
                        
                        fetch(`/api/tareas/${taskId}`, {
                            method: 'DELETE'
                        })
                        .then(response => {
                            if (response.ok) {
                                window.location.reload();
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    }
                });
            });
            
            // Agregar nueva tarea (por ahora solo muestra un alert)
            const addTaskButton = document.querySelector('.add-task-btn');
            
            addTaskButton.addEventListener('click', function() {
                alert('Funcionalidad de agregar tarea en desarrollo');
                // Aquí se implementaría un modal o redirección a un formulario
            });
        });
    </script>
</body>
</html>